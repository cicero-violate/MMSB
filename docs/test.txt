{
  "goal": "Develop an MMSB (Model‑based, Message‑driven, State‑based) system and show its DAG with dependency + priority",
  "dag": {
    "nodes": [
      "Invariants",
      "State(Page)",
      "Delta(Message)",
      "Reducer(Apply)",
      "Scheduler(Tick)",
      "Validation",
      "Storage",
      "Query",
      "Replay/Simulation"
    ],
    "edges": [
      { "from": "Invariants", "to": "Validation" },
      { "from": "State(Page)", "to": "Reducer(Apply)" },
      { "from": "Delta(Message)", "to": "Reducer(Apply)" },
      { "from": "Reducer(Apply)", "to": "Validation" },
      { "from": "Validation", "to": "Storage" },
      { "from": "Storage", "to": "Query" },
      { "from": "Storage", "to": "Replay/Simulation" },
      { "from": "Scheduler(Tick)", "to": "Reducer(Apply)" }
    ]
  },
  "priority_list": [
    {
      "priority": 1,
      "component": "Invariants",
      "reason": "Hard laws (accounting, conservation). Must exist before anything runs."
    },
    {
      "priority": 2,
      "component": "State(Page)",
      "reason": "Defines what exists; immutable snapshot of the world."
    },
    {
      "priority": 3,
      "component": "Delta(Message)",
      "reason": "Defines how state can change; no side effects."
    },
    {
      "priority": 4,
      "component": "Reducer(Apply)",
      "reason": "Pure function: (state, delta) → new_state."
    },
    {
      "priority": 5,
      "component": "Validation",
      "reason": "Enforces invariants after every transition."
    },
    {
      "priority": 6,
      "component": "Scheduler(Tick)",
      "reason": "Orders deltas deterministically in time."
    },
    {
      "priority": 7,
      "component": "Storage",
      "reason": "Persists validated states and deltas."
    },
    {
      "priority": 8,
      "component": "Query",
      "reason": "Read‑only observation; must not mutate state."
    },
    {
      "priority": 9,
      "component": "Replay/Simulation",
      "reason": "Deterministic reconstruction and stress testing."
    }
  ],
  "code_skeleton_julia": {
    "State": "struct Page; assets::Float64; liabilities::Float64; equity::Float64; end",
    "Delta": "abstract type Delta end",
    "Apply": "apply(page::Page, d::Delta)::Page",
    "Invariant": "check(page::Page)::Bool",
    "Tick": "pageₜ₊₁ = check(apply(pageₜ, delta)) ? apply(pageₜ, delta) : error(\"Invariant violation\")"
  },
  "design_laws": [
    "Queries never mutate",
    "All mutations are deltas",
    "All deltas are replayable",
    "All state transitions are validated",
    "If invariants fail, the tick fails"
  ]
}
