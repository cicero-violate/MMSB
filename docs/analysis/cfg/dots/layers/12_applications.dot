digraph LayerCFG {
  rankdir=TB;
  compound=true;
  newrank=true;

  label="12_applications - 9 functions from 5 files";
  labelloc=t;
  fontsize=18;

  subgraph cluster_1 {
    label="AgentCoordinator (multi_agent_system.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f1_n1566 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f1_n1567 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f1_n1568 [label="BB1 L19", shape=box, fillcolor=lightblue, style="filled"];

    f1_n1566 -> f1_n1568;
    f1_n1568 -> f1_n1567;
  }

  subgraph cluster_2 {
    label="MMSBContext (llm_tools.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f2_n1569 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f2_n1570 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f2_n1571 [label="BB1 L19", shape=box, fillcolor=lightblue, style="filled"];

    f2_n1569 -> f2_n1571;
    f2_n1571 -> f2_n1570;
  }

  subgraph cluster_3 {
    label="Portfolio (financial_modeling.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f3_n1572 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f3_n1573 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f3_n1574 [label="BB1 L25", shape=box, fillcolor=lightblue, style="filled"];

    f3_n1572 -> f3_n1574;
    f3_n1574 -> f3_n1573;
  }

  subgraph cluster_4 {
    label="World (world_simulation.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f4_n1575 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f4_n1576 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f4_n1577 [label="BB1 L28", shape=box, fillcolor=lightblue, style="filled"];

    f4_n1575 -> f4_n1577;
    f4_n1577 -> f4_n1576;
  }

  subgraph cluster_5 {
    label="coordinate_step! (multi_agent_system.jl, CC=3)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f5_n1578 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f5_n1579 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f5_n1580 [label="BRANCH1 L26", shape=diamond, fillcolor=yellow, style="filled"];
    f5_n1581 [label="LOOP2 L27", shape=box, fillcolor=orange, style="filled,rounded"];
    f5_n1582 [label="BB3 L28", shape=box, fillcolor=lightblue, style="filled"];

    f5_n1578 -> f5_n1580;
    f5_n1580 -> f5_n1581 [label="T", color="darkgreen"];
    f5_n1580 -> f5_n1582 [label="F", color="red"];
    f5_n1581 -> f5_n1582 [label="T", color="darkgreen"];
    f5_n1582 -> f5_n1581;
    f5_n1582 -> f5_n1579;
  }

  subgraph cluster_6 {
    label="rebalance! (financial_modeling.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f6_n1583 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f6_n1584 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f6_n1585 [label="BB1 L37", shape=box, fillcolor=lightblue, style="filled"];

    f6_n1583 -> f6_n1585;
    f6_n1585 -> f6_n1584;
  }

  subgraph cluster_7 {
    label="register_agent! (multi_agent_system.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f7_n1586 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f7_n1587 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f7_n1588 [label="BB1 L22", shape=box, fillcolor=lightblue, style="filled"];

    f7_n1586 -> f7_n1588;
    f7_n1588 -> f7_n1587;
  }

  subgraph cluster_8 {
    label="simulate_step! (world_simulation.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f8_n1589 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f8_n1590 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f8_n1591 [label="BB1 L38,40", shape=box, fillcolor=lightblue, style="filled"];

    f8_n1589 -> f8_n1591;
    f8_n1591 -> f8_n1590;
  }

  subgraph cluster_9 {
    label="store_llm_response (llm_tools.jl, CC=1)";
    style=filled;
    fillcolor=lightgray;
    color=black;

    f9_n1592 [label="ENTRY", shape=ellipse, fillcolor=lightgreen, style="filled,bold"];
    f9_n1593 [label="EXIT", shape=doubleoctagon, fillcolor=lightcoral, style="filled,bold"];
    f9_n1594 [label="BB1 L29", shape=box, fillcolor=lightblue, style="filled"];

    f9_n1592 -> f9_n1594;
    f9_n1594 -> f9_n1593;
  }

  // Inter-function calls
  edge [style=dashed, color=blue, penwidth=2];

  f3_n1573 -> f3_n1572 [ltail=cluster_3, lhead=cluster_3, label="call"];
  f2_n1570 -> f2_n1569 [ltail=cluster_2, lhead=cluster_2, label="call"];
  f1_n1567 -> f1_n1566 [ltail=cluster_1, lhead=cluster_1, label="call"];
  f4_n1576 -> f4_n1575 [ltail=cluster_4, lhead=cluster_4, label="call"];
}
