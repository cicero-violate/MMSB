# Structure Group: src/ffi.rs

## File: MMSB/src/ffi.rs

- Layer(s): root
- Language coverage: Rust (74)
- Element types: Enum (1), Function (56), Impl (7), Struct (10)
- Total elements: 74

### Elements

- [Rust | Struct] `AllocatorHandle` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct AllocatorHandle { pub ptr : * mut PageAllocator , }`
- [Rust | Struct] `DeltaHandle` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct DeltaHandle { pub ptr : * mut Delta , }`
- [Rust | Struct] `EpochABI` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct EpochABI { pub value : u32 , }`
- [Rust | Impl] `From for impl From < EpochABI > for Epoch { fn from (value : EpochABI) -> Self { Epoch (value . value) } } . self_ty` (line 0, priv)
- [Rust | Enum] `MMSBErrorCode` (line 0, pub)
- [Rust | Struct] `PageHandle` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct PageHandle { pub ptr : * mut Page , }`
- [Rust | Struct] `PageInfoABI` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct PageInfoABI { pub page_id : u64 , pub size : usize , pub location :...`
- [Rust | Struct] `SemiringPairBool` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy , Debug , Default)] pub struct SemiringPairBool { pub add : u8 , pub mul : u8 , }`
- [Rust | Struct] `SemiringPairF64` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy , Debug , Default)] pub struct SemiringPairF64 { pub add : f64 , pub mul : f64 , }`
- [Rust | Struct] `TLogHandle` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct TLogHandle { pub ptr : * mut TransactionLog , }`
- [Rust | Struct] `TLogReaderHandle` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy)] pub struct TLogReaderHandle { pub ptr : * mut TransactionLogReader , }`
- [Rust | Struct] `TLogSummary` (line 0, pub)
  - Signature: `# [repr (C)] # [derive (Clone , Copy , Default)] pub struct TLogSummary { pub total_deltas : u64 , pub total_bytes : ...`
- [Rust | Function] `convert_location` (line 0, priv)
  - Signature: `fn convert_location (tag : i32) -> Result < PageLocation , PageError > { PageLocation :: from_tag (tag) } . sig`
  - Calls: PageLocation::from_tag
- [Rust | Impl] `impl AllocatorHandle { fn null () -> Self { Self { ptr : ptr :: null_mut () , } } } . self_ty` (line 0, priv)
- [Rust | Impl] `impl DeltaHandle { fn null () -> Self { Self { ptr : ptr :: null_mut () , } } } . self_ty` (line 0, priv)
- [Rust | Impl] `impl MMSBErrorCode { pub fn is_retryable (& self) -> bool { matches ! (self , MMSBErrorCode :: IOError | MMSBErrorCode :: NetworkError | MMSBErrorCode :: MemoryPressure) } pub fn is_fatal (& self) -> bool { matches ! (self , MMSBErrorCode :: CorruptLog | MMSBErrorCode :: ChecksumMismatch | MMSBErrorCode :: InvalidHandle) } } . self_ty` (line 0, priv)
- [Rust | Impl] `impl PageHandle { fn null () -> Self { Self { ptr : ptr :: null_mut () , } } } . self_ty` (line 0, priv)
- [Rust | Impl] `impl TLogHandle { fn null () -> Self { Self { ptr : ptr :: null_mut () , } } } . self_ty` (line 0, priv)
- [Rust | Impl] `impl TLogReaderHandle { fn null () -> Self { Self { ptr : ptr :: null_mut () , } } } . self_ty` (line 0, priv)
- [Rust | Function] `log_error_code` (line 0, priv)
  - Signature: `fn log_error_code (err : & std :: io :: Error) -> MMSBErrorCode { if err . kind () == ErrorKind :: InvalidData { MMSB...`
  - Calls: kind
- [Rust | Function] `mask_from_bytes` (line 0, priv)
  - Signature: `fn mask_from_bytes (ptr : * const u8 , len : usize , payload_len : usize , is_sparse : bool) -> Vec < bool > { if ptr...`
  - Calls: is_null, Vec::new, std::slice::from_raw_parts, saturating_mul, collect, map, iter, Vec::with_capacity, saturating_mul, push, len, truncate
- [Rust | Function] `mmsb_allocator_allocate` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_allocate (handle : AllocatorHandle , page_id_hint : u64 , size : usize...`
  - Calls: is_null, set_last_error, PageHandle::null, set_last_error, PageHandle::null, PageLocation::from_tag, Some, allocate_raw, PageID, set_last_error, PageHandle::null
- [Rust | Function] `mmsb_allocator_clear` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_clear (handle : AllocatorHandle) { if handle . ptr . is_null () { set_...`
  - Calls: is_null, set_last_error, clear
- [Rust | Function] `mmsb_allocator_free` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_free (handle : AllocatorHandle) { if ! handle . ptr . is_null () { ffi...`
  - Calls: is_null, drop, Box::from_raw
- [Rust | Function] `mmsb_allocator_get_page` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_get_page (handle : AllocatorHandle , page_id : u64) -> PageHandle { if...`
  - Calls: is_null, set_last_error, PageHandle::null, acquire_page, PageID, set_last_error, PageHandle::null
- [Rust | Function] `mmsb_allocator_list_pages` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_list_pages (handle : AllocatorHandle , out_infos : * mut PageInfoABI ,...`
  - Calls: is_null, is_null, set_last_error, page_infos, min, len, with, borrow_mut, clear, extend, map, take, iter, clone, enumerate, take, iter, is_empty, std::ptr::null, as_ptr, len, add
- [Rust | Function] `mmsb_allocator_new` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_new () -> AllocatorHandle { ffi_debug ! ("=== mmsb_allocator_new START...`
  - Calls: PageAllocatorConfig::default, PageAllocator::new, Box::new, Box::into_raw
- [Rust | Function] `mmsb_allocator_page_count` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_page_count (handle : AllocatorHandle) -> usize { if handle . ptr . is_...`
  - Calls: is_null, set_last_error, len
- [Rust | Function] `mmsb_allocator_release` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_allocator_release (handle : AllocatorHandle , page_id : u64) { if handle . ptr ....`
  - Calls: is_null, set_last_error, release, PageID
- [Rust | Function] `mmsb_checkpoint_load` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_checkpoint_load (allocator : AllocatorHandle , log : TLogHandle , path : * const...`
  - Calls: is_null, to_str, CStr::from_ptr, is_null, is_null, is_null, set_last_error, to_str, CStr::from_ptr, to_owned, set_last_error, checkpoint::load_checkpoint, set_last_error
- [Rust | Function] `mmsb_checkpoint_write` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_checkpoint_write (allocator : AllocatorHandle , log : TLogHandle , path : * cons...`
  - Calls: is_null, to_str, CStr::from_ptr, is_null, is_null, is_null, set_last_error, to_str, CStr::from_ptr, to_owned, set_last_error, checkpoint::write_checkpoint, set_last_error
- [Rust | Function] `mmsb_delta_apply` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_apply (page : PageHandle , delta : DeltaHandle) -> i32 { if page . ptr . i...`
  - Calls: is_null, is_null, set_last_error, apply_delta, set_last_error
- [Rust | Function] `mmsb_delta_copy_intent_metadata` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_copy_intent_metadata (handle : DeltaHandle , dst : * mut u8 , len : usize ...`
  - Calls: is_null, is_null, set_last_error, as_bytes, min, len, std::ptr::copy_nonoverlapping, as_ptr
- [Rust | Function] `mmsb_delta_copy_mask` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_copy_mask (handle : DeltaHandle , dst : * mut u8 , len : usize) -> usize {...`
  - Calls: is_null, is_null, set_last_error, min, len, take, enumerate, iter, add
- [Rust | Function] `mmsb_delta_copy_payload` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_copy_payload (handle : DeltaHandle , dst : * mut u8 , len : usize) -> usiz...`
  - Calls: is_null, is_null, set_last_error, min, len, std::ptr::copy_nonoverlapping, as_ptr
- [Rust | Function] `mmsb_delta_copy_source` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_copy_source (handle : DeltaHandle , dst : * mut u8 , len : usize) -> usize...`
  - Calls: is_null, is_null, set_last_error, as_bytes, min, len, std::ptr::copy_nonoverlapping, as_ptr
- [Rust | Function] `mmsb_delta_epoch` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_epoch (handle : DeltaHandle) -> u32 { if handle . ptr . is_null () { set_l...`
  - Calls: is_null, set_last_error
- [Rust | Function] `mmsb_delta_free` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_free (handle : DeltaHandle) { if ! handle . ptr . is_null () { unsafe { dr...`
  - Calls: is_null, drop, Box::from_raw
- [Rust | Function] `mmsb_delta_id` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_id (handle : DeltaHandle) -> u64 { if handle . ptr . is_null () { set_last...`
  - Calls: is_null, set_last_error
- [Rust | Function] `mmsb_delta_intent_metadata_len` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_intent_metadata_len (handle : DeltaHandle) -> usize { if handle . ptr . is...`
  - Calls: is_null, set_last_error, unwrap_or, map, as_ref, len
- [Rust | Function] `mmsb_delta_is_sparse` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_is_sparse (handle : DeltaHandle) -> u8 { if handle . ptr . is_null () { se...`
  - Calls: is_null, set_last_error
- [Rust | Function] `mmsb_delta_mask_len` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_mask_len (handle : DeltaHandle) -> usize { if handle . ptr . is_null () { ...`
  - Calls: is_null, set_last_error, len
- [Rust | Function] `mmsb_delta_new` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_new (delta_id : u64 , page_id : u64 , epoch : EpochABI , mask_ptr : * cons...`
  - Calls: mask_from_bytes, vec_from_ptr, is_null, to_string, to_string, to_string_lossy, CStr::from_ptr, DeltaID, PageID, into, Source, Box::new, Box::into_raw
- [Rust | Function] `mmsb_delta_page_id` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_page_id (handle : DeltaHandle) -> u64 { if handle . ptr . is_null () { set...`
  - Calls: is_null, set_last_error
- [Rust | Function] `mmsb_delta_payload_len` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_payload_len (handle : DeltaHandle) -> usize { if handle . ptr . is_null ()...`
  - Calls: is_null, set_last_error, len
- [Rust | Function] `mmsb_delta_set_intent_metadata` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_set_intent_metadata (handle : DeltaHandle , metadata_ptr : * const u8 , me...`
  - Calls: is_null, set_last_error, is_null, std::slice::from_raw_parts, std::str::from_utf8, Some, to_string, set_last_error
- [Rust | Function] `mmsb_delta_source_len` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_source_len (handle : DeltaHandle) -> usize { if handle . ptr . is_null () ...`
  - Calls: is_null, set_last_error, len
- [Rust | Function] `mmsb_delta_timestamp` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_delta_timestamp (handle : DeltaHandle) -> u64 { if handle . ptr . is_null () { s...`
  - Calls: is_null, set_last_error
- [Rust | Function] `mmsb_error_is_fatal` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_error_is_fatal (code : MMSBErrorCode) -> bool { code . is_fatal () } . sig`
  - Calls: is_fatal
- [Rust | Function] `mmsb_error_is_retryable` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_error_is_retryable (code : MMSBErrorCode) -> bool { code . is_retryable () } . sig`
  - Calls: is_retryable
- [Rust | Function] `mmsb_get_last_error` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_get_last_error () -> MMSBErrorCode { TLS_LAST_ERROR . with (| cell | { let mut g...`
  - Calls: with, borrow_mut
- [Rust | Function] `mmsb_page_epoch` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_epoch (handle : PageHandle) -> u32 { if handle . ptr . is_null () { set_las...`
  - Calls: is_null, set_last_error, epoch
- [Rust | Function] `mmsb_page_metadata_export` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_metadata_export (handle : PageHandle , dst : * mut u8 , len : usize) -> usi...`
  - Calls: is_null, is_null, set_last_error, metadata_blob, min, len, std::ptr::copy_nonoverlapping, as_ptr
- [Rust | Function] `mmsb_page_metadata_import` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_metadata_import (handle : PageHandle , src : * const u8 , len : usize) -> i...`
  - Calls: is_null, is_null, set_last_error, std::slice::from_raw_parts, set_metadata_blob, set_last_error
- [Rust | Function] `mmsb_page_metadata_size` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_metadata_size (handle : PageHandle) -> usize { if handle . ptr . is_null ()...`
  - Calls: is_null, set_last_error, len, metadata_blob
- [Rust | Function] `mmsb_page_read` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_read (handle : PageHandle , dst : * mut u8 , len : usize) -> usize { ffi_de...`
  - Calls: is_null, set_last_error, size, is_null, set_last_error, size, min, data_slice, std::ptr::copy_nonoverlapping, as_ptr
- [Rust | Function] `mmsb_page_write_masked` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_page_write_masked (handle : PageHandle , mask_ptr : * const u8 , mask_len : usiz...`
  - Calls: is_null, set_last_error, mask_from_bytes, vec_from_ptr, DeltaID, into, Source, into, apply_delta, set_last_error
- [Rust | Function] `mmsb_semiring_boolean_accumulate` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_boolean_accumulate (left : u8 , right : u8) -> SemiringPairBool { let s...`
  - Calls: accumulate
- [Rust | Function] `mmsb_semiring_boolean_fold_add` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_boolean_fold_add (values : * const u8 , len : usize) -> u8 { let semiri...`
  - Calls: zero, slice_from_ptr, map, iter, fold_add
- [Rust | Function] `mmsb_semiring_boolean_fold_mul` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_boolean_fold_mul (values : * const u8 , len : usize) -> u8 { let semiri...`
  - Calls: one, slice_from_ptr, map, iter, fold_mul
- [Rust | Function] `mmsb_semiring_tropical_accumulate` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_tropical_accumulate (left : f64 , right : f64) -> SemiringPairF64 { let...`
  - Calls: accumulate
- [Rust | Function] `mmsb_semiring_tropical_fold_add` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_tropical_fold_add (values : * const f64 , len : usize) -> f64 { let sem...`
  - Calls: zero, slice_from_ptr, fold_add, copied, iter
- [Rust | Function] `mmsb_semiring_tropical_fold_mul` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_semiring_tropical_fold_mul (values : * const f64 , len : usize) -> f64 { let sem...`
  - Calls: one, slice_from_ptr, fold_mul, copied, iter
- [Rust | Function] `mmsb_tlog_append` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_append (handle : TLogHandle , delta : DeltaHandle) -> i32 { if handle . ptr...`
  - Calls: is_null, is_null, set_last_error, append, clone, set_last_error, log_error_code
- [Rust | Function] `mmsb_tlog_clear_entries` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_clear_entries (handle : TLogHandle) { if handle . ptr . is_null () { set_la...`
  - Calls: is_null, set_last_error, clear_entries
- [Rust | Function] `mmsb_tlog_free` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_free (handle : TLogHandle) { if ! handle . ptr . is_null () { unsafe { drop...`
  - Calls: is_null, drop, Box::from_raw
- [Rust | Function] `mmsb_tlog_new` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_new (path : * const c_char) -> TLogHandle { if path . is_null () { set_last...`
  - Calls: is_null, set_last_error, TLogHandle::null, CStr::from_ptr, to_str, set_last_error, TLogHandle::null, to_owned, TransactionLog::new, Box::into_raw, Box::new, set_last_error, log_error_code, TLogHandle::null
- [Rust | Function] `mmsb_tlog_reader_free` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_reader_free (handle : TLogReaderHandle) { if ! handle . ptr . is_null () { ...`
  - Calls: is_null, drop, Box::from_raw
- [Rust | Function] `mmsb_tlog_reader_new` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_reader_new (path : * const c_char) -> TLogReaderHandle { if path . is_null ...`
  - Calls: is_null, set_last_error, TLogReaderHandle::null, to_str, CStr::from_ptr, to_owned, set_last_error, TLogReaderHandle::null, TransactionLogReader::open, Box::into_raw, Box::new, set_last_error, log_error_code, TLogReaderHandle::null
- [Rust | Function] `mmsb_tlog_reader_next` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_reader_next (handle : TLogReaderHandle) -> DeltaHandle { if handle . ptr . ...`
  - Calls: is_null, set_last_error, DeltaHandle::null, next, Box::new, Box::into_raw, DeltaHandle::null, set_last_error, log_error_code, DeltaHandle::null
- [Rust | Function] `mmsb_tlog_summary` (line 0, pub)
  - Signature: `# [no_mangle] pub extern "C" fn mmsb_tlog_summary (path : * const c_char , out : * mut TLogSummary) -> i32 { if path ...`
  - Calls: is_null, is_null, set_last_error, to_str, CStr::from_ptr, set_last_error, crate::page::tlog::summary, set_last_error, log_error_code
- [Rust | Function] `set_last_error` (line 0, priv)
  - Signature: `fn set_last_error (code : MMSBErrorCode) { TLS_LAST_ERROR . with (| cell | { * cell . borrow_mut () = code ; }) ; } ....`
  - Calls: with, borrow_mut
- [Rust | Function] `slice_from_ptr` (line 0, priv)
  - Signature: `fn slice_from_ptr < 'a , T > (ptr : * const T , len : usize) -> & 'a [T] { if ptr . is_null () || len == 0 { & [] } e...`
  - Generics: 'a, T
  - Calls: is_null, slice::from_raw_parts
- [Rust | Function] `vec_from_ptr` (line 0, priv)
  - Signature: `fn vec_from_ptr (ptr : * const u8 , len : usize) -> Vec < u8 > { if ptr . is_null () || len == 0 { return Vec :: new ...`
  - Calls: is_null, Vec::new, to_vec, std::slice::from_raw_parts

